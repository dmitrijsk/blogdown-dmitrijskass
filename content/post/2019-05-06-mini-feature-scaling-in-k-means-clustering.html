---
title: 'Mini: feature scaling in k-means clustering'
author: Dmitrijs Kass
date: '2019-05-06'
slug: mini-feature-scaling-in-k-means-clustering
categories:
  - mini
  - clusterings
tags: []
output:
  blogdown::html_page:
    toc: true
draft: false
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>

<div id="TOC">
<ul>
<li><a href="#surprise">Surprise</a></li>
<li><a href="#k-means-clustering-with-original-features">K-means clustering with original features</a></li>
<li><a href="#feature-scaling-and-k-means-revisited">Feature scaling and k-means revisited</a></li>
</ul>
</div>

<pre class="r"><code># Attach packages.
library(tidyverse)

# Import phone data.
phones_df &lt;- read_delim(file = &quot;iphone_dataset.csv&quot;, delim = &quot;;&quot;, skip = 2)

# Print phone data.
phones_df %&gt;% 
  knitr::kable(col.names = c(&quot;Brand&quot;, &quot;Model&quot;, &quot;Approx. price (EUR)&quot;, &quot;Weight (g)&quot;), format = &quot;html&quot;) %&gt;% 
  kableExtra::kable_styling(full_width = FALSE, bootstrap_options = c(&quot;striped&quot;, &quot;condensed&quot;))</code></pre>
<table class="table table-striped table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Brand
</th>
<th style="text-align:left;">
Model
</th>
<th style="text-align:right;">
Approx. price (EUR)
</th>
<th style="text-align:right;">
Weight (g)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Apple
</td>
<td style="text-align:left;">
iPhone 4
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:right;">
137
</td>
</tr>
<tr>
<td style="text-align:left;">
Apple
</td>
<td style="text-align:left;">
iPhone 6
</td>
<td style="text-align:right;">
360
</td>
<td style="text-align:right;">
129
</td>
</tr>
<tr>
<td style="text-align:left;">
Apple
</td>
<td style="text-align:left;">
iPhone 6s Plus
</td>
<td style="text-align:right;">
470
</td>
<td style="text-align:right;">
192
</td>
</tr>
<tr>
<td style="text-align:left;">
Apple
</td>
<td style="text-align:left;">
iPhone 8 Plus
</td>
<td style="text-align:right;">
770
</td>
<td style="text-align:right;">
202
</td>
</tr>
</tbody>
</table>
<div id="surprise" class="section level1">
<h1>Surprise</h1>
<pre class="r"><code>phones_df %&gt;% 
  ggplot(aes(x = weight_g, y = approx_price_eur)) + 
  geom_point(size = 4, shape = &quot;x&quot;) +
  geom_text(aes(label = model), size = 3.5, vjust = &quot;top&quot;, nudge_y = -20) +
  scale_x_continuous(expand = expand_scale(mult = 0.3)) +
  scale_y_continuous(expand = expand_scale(mult = 0.3)) +
  labs(title = &quot;How would you assign these 4 iPhones into 2 clusters?&quot;,
       x = &quot;weight (g)&quot;, 
       y = &quot;price (EUR)&quot;) +
  theme_classic()</code></pre>
<p><img src="/post/2019-05-06-mini-feature-scaling-in-k-means-clustering_files/figure-html/unnamed-chunk-2-1.png" width="576" /></p>
</div>
<div id="k-means-clustering-with-original-features" class="section level1">
<h1>K-means clustering with original features</h1>
<pre class="r"><code># Save columns for clustering in a separate matrix.
phones_mat &lt;- as.matrix(phones_df %&gt;% select(approx_price_eur, weight_g))

# Add rownames to see phone models in a distance matrix.
rownames(phones_mat) &lt;- phones_df$model</code></pre>
<pre class="r"><code># k-means.
set.seed(1)
kmeans_fit &lt;- kmeans(phones_mat, centers = 2, nstart = 100)

# Small data frame with cluster centers.
centers_df &lt;- as_tibble(kmeans_fit$centers) %&gt;%
  mutate(cluster = 1:2)</code></pre>
<pre class="r"><code>p &lt;- phones_df %&gt;% 
  mutate(cluster = kmeans_fit$cluster) %&gt;% 
  ggplot(aes(x = weight_g, y = approx_price_eur, color = as.factor(cluster))) + 
  geom_point(size = 4, shape = &quot;x&quot;) +
  geom_text(aes(label = model), size = 3.5, vjust = &quot;top&quot;, nudge_y = -20) +
  geom_point(data = centers_df, size = 4) +
  scale_x_continuous(expand = expand_scale(mult = 0.3)) +
  scale_y_continuous(expand = expand_scale(mult = 0.3)) +
  labs(title = &quot;Hopefully, you are surprised to see iPhone 8 Plus alone in cluster 2&quot;,
       subtitle = &quot;k-means clustering with original (not scaled) features&quot;,
       x = &quot;weight (g)&quot;, 
       y = &quot;price (EUR)&quot;, 
       color = &quot;Cluster centers&quot;) +
  theme_classic() +
  theme(legend.position = &quot;top&quot;)

p</code></pre>
<p><img src="/post/2019-05-06-mini-feature-scaling-in-k-means-clustering_files/figure-html/unnamed-chunk-5-1.png" width="576" /></p>
<pre class="r"><code># Adjust axes to the same scale.
p +
  labs(title = &quot;No more surprise after equally scaling axes&quot;) +
  scale_y_continuous(limits = c(0, 800)) +
  scale_x_continuous(limits = c(0, 800)) +
  coord_equal()</code></pre>
<p><img src="/post/2019-05-06-mini-feature-scaling-in-k-means-clustering_files/figure-html/unnamed-chunk-6-1.png" width="576" /></p>
</div>
<div id="feature-scaling-and-k-means-revisited" class="section level1">
<h1>Feature scaling and k-means revisited</h1>
<p>Below are Eucledean distances between phones using original features. Values of distances are not interpretable per se because those are euros and grams combined. Magnitudes is what we are interested in. Notice that the distance between “Galaxy S8+” and “Galaxy A7” (190.44) is the second largest distance.</p>
<pre class="r"><code>round(dist(phones_mat), 2)</code></pre>
<pre><code>##                iPhone 4 iPhone 6 iPhone 6s Plus
## iPhone 6         160.20                        
## iPhone 6s Plus   275.54   126.76               
## iPhone 8 Plus    573.69   416.45         300.17</code></pre>
<p>Now compare it with the same distance calculated from scaled features. It is now</p>
<p>Distance matrix after feature scaling.</p>
<pre class="r"><code>phones_mat_scaled &lt;- scale(phones_mat)
round(dist(phones_mat_scaled), 2)</code></pre>
<pre><code>##                iPhone 4 iPhone 6 iPhone 6s Plus
## iPhone 6           0.70                        
## iPhone 6s Plus     1.85     1.75               
## iPhone 8 Plus      2.94     2.60           1.28</code></pre>
<!-- round(dist(phones_mat), 2) %>% as.matrix() %>% as.data.frame() %>% rownames_to_column() %>% gather(model_to, distance, -rowname) %>% filter(rowname == "Galaxy S8+") -->
</div>
